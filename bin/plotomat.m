function plotomat(control,data,files_op,opt_check,save_path)
%% 00a Include normalising values

%% 00b Create figure
% Set the program title
prog_title = 'PLOT-O-MAT v2.0';
% Create and then hide the GUI during the construction process
pm_main = figure('Visible','off');
% Deactivate numbering of the figure
set(pm_main,'NumberTitle','off')
% Set units of the figure to pixel and hide menu bar.
set(pm_main,'Units','pixel','MenuBar','none','Pointer','arrow','Renderer','zbuffer');
% Set size and position (absolute pixel) of the figure and set name of the GUI
set(pm_main,'Position',[100,50,1605,955],'Resize','Off','Name',prog_title);
% Change the background color of the GUI to black
set(pm_main,'Color',[0.8,0.8,0.8]);

% Preallocate axes cell array
ax_array = cell(3,3);

%% 00c Suppress warning
% Axes in loop warning
 %#ok<*LAXES>
% Try withoug catch block
 %#ok<*TRYNC>
 
%% 01a Create control panel
% Create buttongroup
set_pan = uipanel('Title','Setup',...
                  'Parent',pm_main,...
                  'Units','pixel','Position',[5,5,400,950],...
                  'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                  'TitlePosition','lefttop',...
                  'Fontsize',12,'FontWeight','Bold',...
                  'Visible','Off');
              
%% 01b Create elements in control panel

% Create first popup for elemental arrangement selection
set_pan_txt1 = uicontrol('Style','Text',...
                         'String','Plot arrangement',...
                         'FontSize',14,'FontWeight','bold',...
                         'HorizontalAlignment','center',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                         'Parent',set_pan,...
                         'Position',[25,895,350,25]);
pop1_str = {'1x1 (large)';'1x1 (small)';'2x1';'3x1';'1x2';'1x3';'2x2';'2x3';'3x2';'3x3'};
set_pan_pop1 = uicontrol('Style','popup',...
                         'String',pop1_str,...
                         'Value',1,...
                         'FontSize',14,'FontWeight','bold',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                         'Parent',set_pan,...
                         'Position',[25,870,350,20],...
                         'Callback',@arrangement_callback);


% Create first selection for data type in buttongroup
control_datatype = 'dat';
% Create buttongroup for data type selection
set_pan_bg = uibuttongroup('Title','Data Type','TitlePosition','centertop',...
                          'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                          'TitlePosition','lefttop',...
                          'Fontsize',12,'FontWeight','Bold',...
                          'Parent',set_pan,'Position',[0.05,0.75,0.9,0.15],'Visible','Off');
set_pan_bg_u1 = uicontrol('Style','Radio','String','Raw data',...
                          'Units','normalized','Position',[0.08,0.67,0.8,0.28],...
                          'parent',set_pan_bg,'Tag','1',...
                          'FontSize',14,'FontWeight','Bold',...
                          'ForegroundColor',[0.0,0.0,0.8],'BackgroundColor',[0.8,0.8,0.8],...
                          'Visible','Off');
set_pan_bg_u2 = uicontrol('Style','Radio','String','Normalised data',...
                          'Units','normalized','Position',[0.08,0.37,0.8,0.28],...
                          'parent',set_pan_bg,'Tag','2',...
                          'FontSize',14,'FontWeight','Bold',...
                          'ToolTipString','Volatile-free normalised to 100%',...
                          'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                          'Visible','Off');
set_pan_bg_u3 = uicontrol('Style','Radio','String','Molar data',...
                          'Units','normalized','Position',[0.08,0.07,0.8,0.28],...
                          'parent',set_pan_bg,'Tag','3',...
                          'FontSize',14,'FontWeight','Bold',...
                          'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                          'Visible','Off');
set(set_pan_bg,'SelectionChangeFcn',@datatype_callback,'SelectedObject',set_pan_bg_u1)

% Y-Axis panels                     
yax_pan = uipanel('Title','Y-Axis Setup',...
                  'Parent',set_pan,...
                  'Units','pixels','Position',[15,300,370,370],...
                  'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                  'TitlePosition','lefttop',...
                  'Fontsize',12,'FontWeight','Bold',...
                  'Visible','Off');

% Set initial y-position 
 ypos = 242;
 % Preallocate 3x3 cell array for y-axis setup panel
 yax_ppan = cell(3,3); 
 yax_ppan_pop1 = cell(3,3); yax_ppan_pop2 = cell(3,3);
 yax_ppan_text1 = cell(3,3); yax_ppan_text2 = cell(3,3);
 yax_ppan_edit1 = cell(3,3); yax_ppan_edit2 = cell(3,3);
 % Create an array for first selection of elements
 ini_arr = [2,3,4;8,9,10;11,12,13];
 % Create an array for axis limits
 axis_arr = cell(4,3);
if sum(opt_check) == 0
    for i = 1:3
        for j = 1:3
            axis_arr{i,j}(1,1) = 0;
            axis_arr{i,j}(1,2) = 15;
        end
    end
else
    for i = 1:3
        for j = 1:3
            ini_header = control.header.valid{ini_arr(i,j),1};
            [axis_arr{i,j}(1,1),axis_arr{i,j}(1,2)] = parse_minmax(files_op,opt_check,data,ini_header,control_datatype);
        end
    end
end
 
if sum(opt_check) == 0
    axis_arr{4,1}(1,1) = 30;
    axis_arr{4,1}(1,2) = 70;
else
    [axis_arr{4,1}(1,1),axis_arr{4,1}(1,2)] = parse_minmax(files_op,opt_check,data,'SiO2',control_datatype);
end

 % Write panel and control elements in loop
for i = 1:3
    % Initial x position, reset in every iteration
    xpos = 10;
    for j = 1:3
        % Panels
        yax_ppan{i,j} = uipanel('Title',sprintf('Plot %s.%s',num2str(i),num2str(j)),...
                                'Parent',yax_pan,...
                                'Units','pixels','Position',[xpos,ypos,110,110],...
                                'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                                'TitlePosition','lefttop',...
                                'Fontsize',8,'FontWeight','Bold',...
                                'Visible','Off');
        % Popups 1 - Element selection
        yax_ppan_pop1{i,j} = uicontrol('Style','popup',...
                                       'String',control.header.valid(:,1),...
                                       'Value',ini_arr(i,j),...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[10,65,90,25],...
                                       'Callback',@elementsel_callback);
        % Text headers for minimum / maximum
        yax_ppan_text1{i,j} = uicontrol('Style','text',...
                                       'String','Minimum',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[2,45,50,20]);
        yax_ppan_text2{i,j} = uicontrol('Style','text',...
                                       'String','Maximum',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[54,45,50,20]);
        % Edit fields for axis minimum and maximum
        yax_ppan_edit1{i,j} = uicontrol('Style','edit',...
                                       'String',axis_arr{i,j}(1,1),...
                                       'Tag','ymin',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[2,30,50,20],...
                                       'Callback',@axeslim_callback);
        yax_ppan_edit2{i,j} = uicontrol('Style','edit',...
                                       'String',axis_arr{i,j}(1,2),...
                                       'Tag','ymax',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[54,30,50,20],...
                                       'Callback',@axeslim_callback);
        % Selection for linear or logarithmic axes
        yax_ppan_pop2{i,j} = uicontrol('Style','popup',...
                                       'String',{'Linear';'Logarithmic'},...
                                       'Value',1,...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',yax_ppan{i,j},...
                                       'Position',[10,2,90,25],...
                                       'Callback',@yaxtypesel_callback);
        % Enable only the first ones     
        if i == 1 && j == 1
            set([yax_ppan_pop1{i,j},yax_ppan_pop2{i,j},yax_ppan_text1{i,j},yax_ppan_text2{i,j},yax_ppan_edit1{i,j},yax_ppan_edit2{i,j}],'Enable','On')
        else
            set([yax_ppan_pop1{i,j},yax_ppan_pop2{i,j},yax_ppan_text1{i,j},yax_ppan_text2{i,j},yax_ppan_edit1{i,j},yax_ppan_edit2{i,j}],'Enable','Off')
        end
        % Make each panel visible
        set(yax_ppan{i,j},'Visible','On')
        % Update x-positiohn
        xpos = xpos + 118;
    end
    % Update y-position
    ypos = ypos - 118;
end

% X-Axis panel
xax_pan = uipanel('Title','X-Axis Setup',...
                  'Parent',set_pan,...
                  'Units','pixels','Position',[20,170,120,120],...
                  'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                  'TitlePosition','lefttop',...
                  'Fontsize',12,'FontWeight','Bold',...
                  'Visible','Off');
        % Popup 1 - Element selection
        xax_ppan_pop1 = uicontrol('Style','popup',...
                                       'String',control.header.valid(:,1),...
                                       'Value',1,...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',xax_pan,...
                                       'Position',[10,65,90,25],...
                                       'Callback',@elementsel_callback);
        % Text headers for minimum / maximum
        xax_ppan_text1 = uicontrol('Style','text',...
                                       'String','Minimum',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                                       'Parent',xax_pan,...
                                       'Position',[2,45,50,20]);
        xax_ppan_text2 = uicontrol('Style','text',...
                                       'String','Maximum',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                                       'Parent',xax_pan,...
                                       'Position',[54,45,50,20]);
        % Edit fields for axis minimum and maximum
        xax_ppan_edit1 = uicontrol('Style','edit',...
                                       'String',axis_arr{4,1}(1,1),...
                                       'Tag','xmin',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',xax_pan,...
                                       'Position',[2,30,50,20],...
                                       'Callback',@axeslim_callback);
        xax_ppan_edit2 = uicontrol('Style','edit',...
                                       'String',axis_arr{4,1}(1,2),...
                                       'Tag','xmax',...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',xax_pan,...
                                       'Position',[54,30,50,20],...
                                       'Callback',@axeslim_callback);
        % Selection for liniar or logarithmic axes
        xax_ppan_pop2 = uicontrol('Style','popup',...
                                       'String',{'Linear';'Logarithmic'},...
                                       'Value',1,...
                                       'FontSize',7,'FontWeight','bold',...
                                       'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,1.0,1.0],...
                                       'Parent',xax_pan,...
                                       'Position',[10,2,90,25],...
                                       'Callback',@xaxtypesel_callback);

% Create update and plot button
set_pan_but1 = uicontrol('Style','Pushbutton',...
                         'String','Update',...
                         'FontSize',16,'FontWeight','bold',...
                         'HorizontalAlignment','center',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[1.0,0.5,0.0],...
                         'Parent',set_pan,...
                         'Position',[30,90,165,50],...
                         'Callback',@update_callback);
set_pan_but2 = uicontrol('Style','Pushbutton',...
                         'String','Plot',...
                         'Tag','fig',...
                         'FontSize',16,'FontWeight','bold',...
                         'HorizontalAlignment','center',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                         'Parent',set_pan,...
                         'Position',[205,90,165,50],...
                         'Callback',@plot_callback);
set_pan_but3 = uicontrol('Style','Pushbutton',...
                         'String','Export PNG',...
                         'Tag','png',...
                         'FontSize',16,'FontWeight','bold',...
                         'HorizontalAlignment','center',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                         'Parent',set_pan,...
                         'Position',[30,30,165,50],...
                         'Callback',@plot_callback);
set_pan_but4 = uicontrol('Style','Pushbutton',...
                         'String','Export EPS',...
                         'Tag','eps',...
                         'FontSize',16,'FontWeight','bold',...
                         'HorizontalAlignment','center',...
                         'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                         'Parent',set_pan,...
                         'Position',[205,30,165,50],...
                         'Callback',@plot_callback);        
                     
%% 01x Make control panel and contents visible

% Popup and buttongroup on top
set([set_pan_txt1,set_pan_pop1,set_pan_bg,set_pan_bg_u1,set_pan_bg_u2,set_pan_bg_u3],'Visible','On')
% X/Y axis panels
set([yax_pan,xax_pan,xax_ppan_pop1,xax_ppan_pop2,xax_ppan_text1,xax_ppan_text2,xax_ppan_edit1,xax_ppan_edit2],'Visible','On')
% Update / plot buttons
set([set_pan_but1,set_pan_but2],'Visible','On')
set([set_pan_but3,set_pan_but4],'Visible','On')
% Set panel visible
set(set_pan,'Visible','On')

%% 02a Create preview panel
% Create buttongroup
pre_pan = uipanel('Title','Preview',...
                  'Parent',pm_main,...
                  'Units','pixel','Position',[405,5,1200,950],...
                  'ForegroundColor',[0.0,0.0,0.0],'BackgroundColor',[0.8,0.8,0.8],...
                  'TitlePosition','lefttop',...
                  'Fontsize',12,'FontWeight','Bold',...
                  'Visible','Off');
              
%% 02x Make control panel visible
set(pre_pan,'Visible','On')

%% Callbacks



%% 01 Arrangement Callbacks

    function arrangement_callback(obj,~)
        % Get the string from popup
        new_val = get(obj,'Value'); obj_str = get(obj,'String'); new_str = obj_str{new_val,1};
        % Get the number from string and create logical array
        M = str2double(new_str(1:1)); N = str2double(new_str(3:3)); ypan_array = false(3,3);
        % Switch entries in logical array to true (single  line loop)
        for I = 1:M; for J = 1:N; ypan_array(I,J) = true; end; end;
        % Enable or disable panels
        for I = 1:3
            for J = 1:3
                if ypan_array(I,J) == true
                    set([yax_ppan_pop1{I,J},yax_ppan_pop2{I,J},yax_ppan_text1{I,J},yax_ppan_text2{I,J},yax_ppan_edit1{I,J},yax_ppan_edit2{I,J}],'Enable','On')
                else
                    set([yax_ppan_pop1{I,J},yax_ppan_pop2{I,J},yax_ppan_text1{I,J},yax_ppan_text2{I,J},yax_ppan_edit1{I,J},yax_ppan_edit2{I,J}],'Enable','Off')
                end
            end
        end 
        % Change colour of the update button
        set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
    end

%% 02 Data type buttongourp callback
    function datatype_callback(~,event)
        % 'Downlight' old selection
        set(event.OldValue,'ForegroundColor',[.0,.0,.0]);
        % 'Highlight' new selection
        set(event.NewValue,'ForegroundColor',[.0,.0,.8]);
        
        % Get new selection
        new_sel = get(event.NewValue,'String');
        % Write datatype into variable
        if strcmpi(new_sel,'Raw data')
            control_datatype = 'dat';
        elseif strcmpi(new_sel,'Normalised data')
            control_datatype = 'norm';
        elseif strcmpi(new_sel,'Molar data')
            control_datatype = 'mol';
        end
        % Change colour of the update button
        set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
    end

%% 03 Element selection, Axis limits, axis type selection callback

    % Callback for elements selection
    function elementsel_callback(obj,~)
        % Get the new header from used object
        new_header = get(obj,'String'); new_header = new_header{get(obj,'Value'),1};
        % Get the parent from used object
        new_val_parent = get(get(obj,'Parent'),'Title');
        
        % Get the indices from the selection panel
        if strcmpi(new_val_parent,'X-Axis Setup')
            I = 4;
            J = 1;
            if sum(opt_check) == 0
                axis_arr{I,J}(1,1) = 30;
                axis_arr{I,J}(1,2) = 70;
            else
                [axis_arr{I,J}(1,1),axis_arr{I,J}(1,2)] = parse_minmax(files_op,opt_check,data,new_header,control_datatype);
                % Get the axes type
                new_val_axtype = get(xax_ppan_pop2,'String'); new_val_axtype = new_val_axtype(get(xax_ppan_pop2,'Value'),1);
                if isnan(axis_arr{I,J}(1,1)) || isnan(axis_arr{I,J}(1,2))
                    if strcmpi(new_val_axtype,'logarithmic')
                        axis_arr{I,J}(1,1) = 0.001; set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,1)))
                        axis_arr{I,J}(1,2) = 1000; set(xax_ppan_edit2,'String',num2str(axis_arr{I,J}(1,2)))
                    else
                        axis_arr{I,J}(1,1) = 0; set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,1)))
                        axis_arr{I,J}(1,2) = 15; set(xax_ppan_edit2,'String',num2str(axis_arr{I,J}(1,2)))
                    end
                else
                    set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,1)))
                    set(xax_ppan_edit2,'String',num2str(axis_arr{I,J}(1,2)))
                end
            end
        else
            I = str2double(new_val_parent(6:6));
            J = str2double(new_val_parent(8:8));
            if sum(opt_check) == 0
                axis_arr{I,J}(1,1) = 0;
                axis_arr{I,J}(1,2) = 15;
            else
                [axis_arr{I,J}(1,1),axis_arr{I,J}(1,2)] = parse_minmax(files_op,opt_check,data,new_header,control_datatype);
                % Get the axes type
                new_val_axtype = get(yax_ppan_pop2{I,J},'String'); new_val_axtype = new_val_axtype(get(yax_ppan_pop2{I,J},'Value'),1);
                if isnan(axis_arr{I,J}(1,1)) || isnan(axis_arr{I,J}(1,2))
                    if strcmpi(new_val_axtype,'logarithmic')
                        axis_arr{I,J}(1,1) = 0.001; set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,1)))
                        axis_arr{I,J}(1,2) = 1000; set(yax_ppan_edit2{I,J},'String',num2str(axis_arr{I,J}(1,2)))
                    else
                        axis_arr{I,J}(1,1) = 0; set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,1)))
                        axis_arr{I,J}(1,2) = 15; set(yax_ppan_edit2{I,J},'String',num2str(axis_arr{I,J}(1,2)))
                    end
                else
                    set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,1)))
                    set(yax_ppan_edit2{I,J},'String',num2str(axis_arr{I,J}(1,2)))
                end
            end
        end

        % Change the colour of the update button
        set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
    end

    % Callback for axes limitation changes
    function axeslim_callback(obj,~)
        
        % Get the new value from used object
        new_val = str2double(get(obj,'String'));
        % Get the tag from the used object
        new_val_tag = get(obj,'Tag');
        % Get the parent from used object
        new_val_parent = get(get(obj,'Parent'),'Title');
        
        % Get the indices from the selection panel
        if strcmpi(new_val_parent,'X-Axis Setup')
            I = 4; 
            J = 1;
            nex_val_axtype = get(xax_ppan_pop2,'String');  nex_val_axtype = nex_val_axtype(get(xax_ppan_pop2,'Value'),1);
        else
            I = str2double(new_val_parent(6:6));
            J = str2double(new_val_parent(8:8));
            nex_val_axtype = get(yax_ppan_pop2{I,J},'String'); nex_val_axtype = nex_val_axtype(get(yax_ppan_pop2{I,J},'Value'),1);
        end
        
        % Report an error if the input was empty or text
        if isnan(new_val)
            if strcmpi(new_val_tag,'xmin')
                errordlg(sprintf('The X-axis minimum input is not valid!\nOnly numeric inputs allowed!\nValid inputs: e.g., 0.0001, 42'),'X-Axis Minimum Input Error','modal')
                set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,1)))
            elseif strcmpi(new_val_tag,'ymin')
                errordlg(sprintf('The Y-axis minimum input is not valid!\nOnly numeric inputs allowed!\nValid inputs: e.g., 0.0001, 42'),'Y-Axis Minimum Input Error','modal')
                set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,1)))
            elseif strcmpi(new_val_tag,'xmax')
                errordlg(sprintf('The X-axis maximum input is not valid!\nOnly numeric inputs allowed!\nValid inputs: e.g., 0.0001, 42'),'X-Axis Maximum Input Error','modal')
                set(xax_ppan_edit2,'String',num2str(axis_arr{I,J}(1,2)))
            elseif strcmpi(new_val_tag,'ymax')
                errordlg(sprintf('The Y-axis maximum input is not valid!\nOnly numeric inputs allowed!\nValid inputs: e.g., 0.0001, 42'),'Y-Axis Maximum Input Error','modal')
                set(yax_ppan_edit2{I,J},'String',num2str(axis_arr{I,J}(1,2)))
            end
        % Report an error if the axis limit is higher or lower than the vice versa
        % minimum or maximum
        elseif sum(strcmpi(new_val_tag,{'xmin','ymin'})) && new_val >= axis_arr{I,J}(1,2)
            if strcmpi(new_val_tag,'xmin')
                errordlg(sprintf('The X-axis minimum input is > than the X-axis maximum!\nOnly use minimum values < than the maximum!'),'X-Axis Min>Max Error','modal')
                set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,1)))
            elseif strcmpi(new_val_tag,'ymin')
                errordlg(sprintf('The Y-axis minimum input is > than the X-axis maximum!\nOnly use minimum values < than the maximum!'),'Y-Axis Min>Max Error','modal')
                set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,1)))
            end
        % Report an error if the axis limit is higher or lower than the vice versa
        % minimum or maximum
        elseif sum(strcmpi(new_val_tag,{'xmax','ymax'})) && new_val <= axis_arr{I,J}(1,1)
            if strcmpi(new_val_tag,'xmax')
                errordlg(sprintf('The X-axis maximum input is < than the X-axis minimum!\nOnly use minimum values > than the minimum!'),'X-Axis Max<Min Error','modal')
                set(xax_ppan_edit2,'String',num2str(axis_arr{I,J}(1,2)))
            elseif strcmpi(new_val_tag,'ymax')
                errordlg(sprintf('The Y-axis maximum input is < than the Y-axis minimum!\nOnly use minimum values > than the minimum!'),'Y-Axis Max<Min Error','modal')
                set(yax_ppan_edit2{I,J},'String',num2str(axis_arr{I,J}(1,2)))
            end
        % Report an error if the axis mimum is negative
        elseif sum(strcmpi(new_val_tag,{'xmin','ymin'})) && new_val < 0
            if strcmpi(new_val_tag,'xmin')
                errordlg(sprintf('The X-axis minimum input is negative!\nOnly use positive minimum values!'),'X-Axis minimum <0 Error','modal')
                set(xax_ppan_edit1,'String',num2str(axis_arr{I,J}(1,2)))
            elseif strcmpi(new_val_tag,'ymin')
                errordlg(sprintf('The Y-axis minimum input is negative!\nOnly use positive minimum values!'),'Y-Axis minimum <0 Error','modal')
                set(yax_ppan_edit1{I,J},'String',num2str(axis_arr{I,J}(1,2)))
            end
        % Report an error if the x-axis is logarithmic and the input value was zero
        elseif sum(strcmpi(new_val_tag,'xmin')) && strcmpi(nex_val_axtype,'logarithmic') && new_val == 0
                errordlg(sprintf('The X-axis is logarithmic and input for X-Axis was 0!\nOnly use minimum values >0 for logatithmic axes!'),'Logarithmic X-Axis minimum = 0 Error','modal')
                set(xax_ppan_edit1,'String','0.0001'); axis_arr{I,J}(1,1) = 0.0001;
        elseif sum(strcmpi(new_val_tag,'ymin')) && strcmpi(nex_val_axtype,'logarithmic') && new_val == 0
                errordlg(sprintf('The Y-axis is logarithmic and input for Y-Axis was 0!\nOnly use minimum values >0 for logatithmic axes!'),'Logatithmic X-Axis minimum = 0 Error','modal')
                set(yax_ppan_edit1{I,J},'String','0.0001');  axis_arr{I,J}(1,1) = 0.0001;
        % Here the input should be valid and therefore the values are
        % overwritten and the update button colour is changed to orange
        else
            if sum(strcmpi(new_val_tag,{'xmin','ymin'}))
                axis_arr{I,J}(1,1) = new_val;
            elseif sum(strcmpi(new_val_tag,{'xmax','ymax'}))
                axis_arr{I,J}(1,2) = new_val;
            end
% Control element
% disp(axis_arr{I,J})
            
            % Change colour of the update button
            set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
        end
    end

    % The two following callback handle the axes type (lin vs. log) and
    % replace 0 by 0.0001 if logartithmic axes have been selected
    function xaxtypesel_callback(obj,~)
        % Get the new value from used object
        new_val_axtype = get(obj,'String'); new_val_axtype = new_val_axtype(get(obj,'Value'),1);
        % If the value in axis minimum was zero, replace it by 0.0001
        if strcmpi(new_val_axtype,'logarithmic') && strcmpi(get(xax_ppan_edit1,'String'),'0')
            warndlg(sprintf('The current X-axis minimum was 0 and\nwas set to 0.001 for logarithmic axis!'),'modal')
            set(xax_ppan_edit1,'String','0.001')
            axis_arr{4,1}(1,1) = 0.001;
        elseif strcmpi(new_val_axtype,'linear') && strcmpi(get(xax_ppan_edit1,'String'),'0.001')
            warndlg(sprintf('The current X-axis minimum was 0.001 and\nwas set to 0 for llinear axis!'),'modal')
            set(xax_ppan_edit1,'String','0')
            axis_arr{4,1}(1,1) = 0;
        end
        
        % Change the colour of the update button
        set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
    end

    function yaxtypesel_callback(obj,~)
        % Get the new value from used object
        new_val_axtype = get(obj,'String'); new_val_axtype = new_val_axtype(get(obj,'Value'),1);
        % Get the parent from used object
        new_val_parent = get(get(obj,'Parent'),'Title');
        % Get the indices from the selection panel
        I = str2double(new_val_parent(6:6));
        J = str2double(new_val_parent(8:8));
        % If the value in axis minimum was zero, replace it by 0.0001
        if strcmpi(new_val_axtype,'logarithmic') && strcmpi(get(yax_ppan_edit1{I,J},'String'),'0')
            warndlg(sprintf('The current Y-axis minimum was 0 and\nwas set to 0.001 for logarithmic axis!'),'modal')
            set(yax_ppan_edit1{I,J},'String','0.001')
            axis_arr{I,J}(1,1) = 0.001;
        elseif strcmpi(new_val_axtype,'llinear') && strcmpi(get(yax_ppan_edit1{I,J},'String'),'0')
            warndlg(sprintf('The current Y-axis minimum was 0.001 and\nwas set to 0 for linear axis!'),'modal')
            set(yax_ppan_edit1{I,J},'String','0')
            axis_arr{I,J}(1,1) = 0;
        end
        
        % Change the colour of the update button
        set(set_pan_but1,'BackGroundColor',[1.0,0.5,0.0])
    end

%% 04 Update button callback
    function update_callback(~,~)
        % Clear the current axes objects
        delete(get(pre_pan,'child'))
        
        % Get the plot arrangement
        plot_arr_str = get(set_pan_pop1,'String'); plot_arr_val = get(set_pan_pop1,'Value'); plot_arr_str = plot_arr_str{plot_arr_val,1};
        % Dimensions of the plots
        M = str2double(plot_arr_str(1:1)); N = str2double(plot_arr_str(3:3));
        
        % Dimension and initial positions
        if strcmpi(plot_arr_str,'1x1 (large)')
            % 0.75 = 900 pix / 0.947 = 900 pix
            xdim = 0.75; ydim = 0.895;
            % 0.083 = 100 / 0.032 = 30 pix
            xpos = 0.083; ypos = 0.079;          
        else
            % 0.229 = 275 pix / 0.289 = 275 pix
            xdim = 0.208; ydim = 0.263;
            % 0.083 = 100 / 0.032 = 30 pix
            xpos = 0.083; ypos = 0.653;  
        end
        
        % Create axes object in loop
        for I = 1:M
            % = 100 pix
            xpos = 0.083;
            for J = 1:N
                % Create the axes object
                ax_array{I,J} = axes('Position',[xpos,ypos,xdim,ydim],...
                                     'Units','Normalized',...
                                     'Parent',pre_pan);
                % Setup the axes limitations
                set(ax_array{I,J},'XLim',[axis_arr{4,1}(1,1) axis_arr{4,1}(1,2)],...
                                  'YLim',[axis_arr{I,J}(1,1) axis_arr{I,J}(1,2)],...
                                  'Box','On');
                % Setup the FontSize
                set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                  'FontSize',control.setup.fonts(1,1).FontSize,...
                                  'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                  'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                  'FontUnits',control.setup.fonts(1,1).FontUnits)
                if strcmpi(plot_arr_str,'1x1 (large)')
                    % Setup the FontSize
                    set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                      'FontSize',control.setup.fonts(1,1).FontSize,...
                                      'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                      'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                      'FontUnits',control.setup.fonts(1,1).FontUnits)
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth)
                    % Create x-axis titles
                    if I == 1
                        xlab_str = get(xax_ppan_pop1,'String');
                        xlab_str = strcmpi(xlab_str{get(xax_ppan_pop1,'Value'),1},control.header.valid);
                        xind = find(xlab_str); xind = xind(1,1);
                        if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                            disp(data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn)
                            xlabel(ax_array{I,J},...
                                            sprintf('%s [%s]',control.header.valid{xind,3},...
                                            data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        else
                            xlabel(ax_array{I,J},...
                                            sprintf('%s',control.header.valid{xind,3}),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        end
                    end
                    % Create y-axis titles
                    ylab_str = get(yax_ppan_pop1{I,J},'String'); 
                    ylab_str = strcmpi(ylab_str{get(yax_ppan_pop1{I,J},'Value'),1},control.header.valid);
                    yind = find(ylab_str); yind = yind(1,1);
                    if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                        ylabel(ax_array{I,J},...
                                        sprintf('%s [%s]',control.header.valid{yind,3},...
                                        data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    else
                        ylabel(ax_array{I,J},...
                                        sprintf('%s',control.header.valid{yind,3}),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    end
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth)
                    
                    % Plot the data
                    % Get the strings out of the popups
                    xs = get(xax_ppan_pop1,'String'); xs = xs{get(xax_ppan_pop1,'Value'),1};
                    ys = get(yax_ppan_pop1{I,J},'String'); ys = ys{get(yax_ppan_pop1{I,J},'Value'),1};
                    % Setup scale factor
                    control.scafac = 1.0;
                    % Calculate the normalized values for ternary plot and plot them in
                    % inverted order, that the last dataset is found at the bottom
                    for nr_dataset = files_op:-1:1
                        % Check if the checkbox for the dataset is enabled
                        if true(opt_check(nr_dataset,1))
                            % Get the correct components from data
                            % For x-axis
                            if isfield(data(1,nr_dataset).(control_datatype),xs)
                                xcalc = data(1,nr_dataset).(control_datatype).(xs).Values;
                            else
                                xcalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),xs);
                            end
                            % For y-axis
                            if isfield(data(1,nr_dataset).(control_datatype),ys)
                                ycalc = data(1,nr_dataset).(control_datatype).(ys).Values;
                            else
                                ycalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),ys);
                            end

                            % Get the size of the normalized values
                            [m,~] = size(xcalc);
                            % Enable hold
                            hold(ax_array{I,J},'on')
                                % Plot the data in this loop
                                for nr_dat = 1:1:m
                                    % Check if columns were supplied in the input and not
                                    % overwritten by the label option
                                    if data(1,nr_dataset).symbol.op.op == true && data(1,nr_dataset).symbol.op.override == false
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew(nr_dat,1).*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol(nr_dat,1)),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size(nr_dat,1).*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec{nr_dat,1},...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc{nr_dat,1});
                                    else
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew.*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size.*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec,...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc);
                                    end
                                    % Plot also labels if enabled
                                    if data(1,nr_dataset).label.op.disp == true
                                        % Check if columns were supplied in the input and not
                                        % overwritten by the label option
                                        if data(1,nr_dataset).label.op.op == true && data(1,nr_dataset).label.op.override == false
                                            text(xcalc(nr_dat),ycalc(nr_dat),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(nr_dat,nr_dataset).label.FontName{nr_dat,1},...
                                                                 'FontSize',data(nr_dat,nr_dataset).label.FontSize(nr_dat,1).*control.scafac,...
                                                                 'FontWeight',data(nr_dat,nr_dataset).label.FontWeight{nr_dat,1},...
                                                                 'FontAngle',data(nr_dat,nr_dataset).label.FontAngle{nr_dat,1},...
                                                                 'Color',data(nr_dat,nr_dataset).label.Color{nr_dat,1},...
                                                                 'FontUnits',data(nr_dat,nr_dataset).label.FontUnits{nr_dat,1},...
                                                                 'VerticalAlignment',data(nr_dat,nr_dataset).label.VertAlign{nr_dat,1},...
                                                                 'HorizontalAlignment',data(nr_dat,nr_dataset).label.HoriAlign{nr_dat,1});
                                        else
                                            text(xcalc(nr_dat),ycalc(nr_dat),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(1,nr_dataset).label.FontName,...
                                                                 'FontSize',data(1,nr_dataset).label.FontSize.*control.scafac,...
                                                                 'FontWeight',data(1,nr_dataset).label.FontWeight,...
                                                                 'FontAngle',data(1,nr_dataset).label.FontAngle,...
                                                                 'Color',data(1,nr_dataset).label.Color,...
                                                                 'FontUnits',data(1,nr_dataset).label.FontUnits,...
                                                                 'VerticalAlignment',data(1,nr_dataset).label.VertAlign,...
                                                                 'HorizontalAlignment',data(1,nr_dataset).label.HoriAlign);
                                        end
                                    end
                                end
                            % Disable hold
                            hold(ax_array{I,J},'off')
                        end
                    end
                else
                    % Setup the FontSize
                    set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                      'FontSize',control.setup.fonts(1,1).FontSize.*0.6,...
                                      'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                      'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                      'FontUnits',control.setup.fonts(1,1).FontUnits)
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth.*0.6)
                    % Create x-axis titles
                    if I == M
                      xlab_str = get(xax_ppan_pop1,'String'); 
                        xlab_str = strcmpi(xlab_str{get(xax_ppan_pop1,'Value'),1},control.header.valid);
                        xind = find(xlab_str); xind = xind(1,1);
                        if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                            xlabel(ax_array{I,J},...
                                            sprintf('%s [%s]',control.header.valid{xind,3},...
                                            data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        else
                            xlabel(ax_array{I,J},...
                                            sprintf('%s',control.header.valid{xind,3}),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        end
                    else
                        set(ax_array{I,J},'XTickLabel',{''})
                    end
                    % Create y-axis titles
                    % Create y-axis titles
                    ylab_str = get(yax_ppan_pop1{I,J},'String'); 
                    ylab_str = strcmpi(ylab_str{get(yax_ppan_pop1{I,J},'Value'),1},control.header.valid);
                    yind = find(ylab_str); yind = yind(1,1);
                    if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                        ylabel(ax_array{I,J},...
                                        sprintf('%s [%s]',control.header.valid{yind,3},...
                                        data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    else
                        ylabel(ax_array{I,J},...
                                        sprintf('%s',control.header.valid{yind,3}),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    end
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth.*0.6)
                    
                    
                    % Plot the data
                    % Get the strings out of the popups
                    xs = get(xax_ppan_pop1,'String'); xs = xs{get(xax_ppan_pop1,'Value'),1};
                    ys = get(yax_ppan_pop1{I,J},'String'); ys = ys{get(yax_ppan_pop1{I,J},'Value'),1};
                    % Setup scale factor
                    control.scafac = 0.6;
                    % Calculate the normalized values for ternary plot and plot them in
                    % inverted order, that the last dataset is found at the bottom
                    for nr_dataset = files_op:-1:1
                        % Check if the checkbox for the dataset is enabled
                        if true(opt_check(nr_dataset,1))
                            % Get the correct components from data
                            % For x-axis
                            if isfield(data(1,nr_dataset).(control_datatype),xs)
                                xcalc = data(1,nr_dataset).(control_datatype).(xs).Values;
                            else
                                xcalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),xs);
                            end
                            % For y-axis
                            if isfield(data(1,nr_dataset).(control_datatype),ys)
                                ycalc = data(1,nr_dataset).(control_datatype).(ys).Values;
                            else
                                ycalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),ys);
                            end

                            % Get the size of the normalized values
                            [m,~] = size(xcalc);
                            % Enable hold
                            hold(ax_array{I,J},'on')
                                % Plot the data in this loop
                                for nr_dat = 1:1:m
                                    % Check if columns were supplied in the input and not
                                    % overwritten by the label option
                                    if data(1,nr_dataset).symbol.op.op == true && data(1,nr_dataset).symbol.op.override == false
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew(nr_dat,1).*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol(nr_dat,1)),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size(nr_dat,1).*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec{nr_dat,1},...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc{nr_dat,1});
                                    else
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew.*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size.*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec,...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc);
                                    end
                                    % Plot also labels if enabled
                                    if data(1,nr_dataset).label.op.disp == true
                                        % Check if columns were supplied in the input and not
                                        % overwritten by the label option
                                        if data(1,nr_dataset).label.op.op == true && data(1,nr_dataset).label.op.override == false
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(nr_dat,nr_dataset).label.FontName{nr_dat,1},...
                                                                 'FontSize',data(nr_dat,nr_dataset).label.FontSize(nr_dat,1).*control.scafac,...
                                                                 'FontWeight',data(nr_dat,nr_dataset).label.FontWeight{nr_dat,1},...
                                                                 'FontAngle',data(nr_dat,nr_dataset).label.FontAngle{nr_dat,1},...
                                                                 'Color',data(nr_dat,nr_dataset).label.Color{nr_dat,1},...
                                                                 'FontUnits',data(nr_dat,nr_dataset).label.FontUnits{nr_dat,1},...
                                                                 'VerticalAlignment',data(nr_dat,nr_dataset).label.VertAlign{nr_dat,1},...
                                                                 'HorizontalAlignment',data(nr_dat,nr_dataset).label.HoriAlign{nr_dat,1});
                                        else
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(1,nr_dataset).label.FontName,...
                                                                 'FontSize',data(1,nr_dataset).label.FontSize.*control.scafac,...
                                                                 'FontWeight',data(1,nr_dataset).label.FontWeight,...
                                                                 'FontAngle',data(1,nr_dataset).label.FontAngle,...
                                                                 'Color',data(1,nr_dataset).label.Color,...
                                                                 'FontUnits',data(1,nr_dataset).label.FontUnits,...
                                                                 'VerticalAlignment',data(1,nr_dataset).label.VertAlign,...
                                                                 'HorizontalAlignment',data(1,nr_dataset).label.HoriAlign);
                                        end
                                    end
                                end
                            % Disable hold
                            hold(ax_array{I,J},'off')
                        end
                    end
                end
                
                % Checkout and change the Y-axis type (lin vs. log)
                % Change labels when logarithmic
                ylab_type = get(yax_ppan_pop2{I,J},'String'); ylab_type = ylab_type{get(yax_ppan_pop2{I,J},'Value'),1};
                if strcmpi(ylab_type,'Logarithmic')
                    set(ax_array{I,J},'YScale','log')
                    ax_str = get(ax_array{I,J},'YTick'); set(ax_array{I,J},'YTickLabel',ax_str);
                elseif strcmpi(ylab_type,'Linear')
                    set(ax_array{I,J},'YScale','linear')
                end
                
                % Checkout and change the X-axis type (lin vs. log)
                % Change labels when logarithmic
                xlab_type = get(xax_ppan_pop2,'String'); xlab_type = xlab_type{get(xax_ppan_pop2,'Value'),1};
                if strcmpi(xlab_type,'Logarithmic')
                    set(ax_array{I,J},'XScale','log')
                    ax_str = get(ax_array{I,J},'XTick'); set(ax_array{I,J},'XTickLabel',ax_str);
                elseif strcmpi(xlab_type,'Linear')
                    set(ax_array{I,J},'XScale','linear')
                end
                
                % Make axes visible
                set(ax_array{I,J},'Visible','On')
                
                % Update X-position
                % = 310 pix
                xpos = xpos + 0.275;
            end
            % Update Y-position #
            % = 275 pix
            ypos = ypos - 0.290;
        end
        

        
        % Change colour of the update button
        set(set_pan_but1,'BackGroundColor',[0.8,0.8,0.8])
    end

%% 05 Plot button callback
    function plot_callback(obj,~)

        % Create and then hide the GUI during the construction process
        plotfig = figure('Visible','off');
        % Set units of the figure to pixel and hide menu bar.
        set(plotfig,'Units','Pixel','MenuBar','Figure','Color',[1.0 1.0 1.0]);
        % Set size and position (absolute pixel) of the figure and set name of the GUI
        set(plotfig,'Position',[25,25,1200,938],'Name','Variation diagrams');
        % Get the plot arrangement
        plot_arr_str = get(set_pan_pop1,'String'); plot_arr_val = get(set_pan_pop1,'Value'); plot_arr_str = plot_arr_str{plot_arr_val,1};
        % Dimensions of the plots
        M = str2double(plot_arr_str(1:1)); N = str2double(plot_arr_str(3:3));
        
        % Dimension and initial positions
        if strcmpi(plot_arr_str,'1x1 (large)')
            % 0.75 = 900 pix / 0.947 = 900 pix
            xdim = 0.75; ydim = 0.895;
            % 0.083 = 100 / 0.032 = 30 pix
            xpos = 0.083; ypos = 0.079;          
        else
            % 0.229 = 275 pix / 0.289 = 275 pix
            xdim = 0.208; ydim = 0.263;
            % 0.083 = 100 / 0.032 = 30 pix
            xpos = 0.083; ypos = 0.653;  
        end
        
        % Create axes object in loop
        for I = 1:M
            % = 100 pix
            xpos = 0.083;
            for J = 1:N
                % Create the axes object
                ax_array{I,J} = axes('Position',[xpos,ypos,xdim,ydim],...
                                     'Units','Normalized',...
                                     'Parent',plotfig);
                % Setup the axes limitations
                set(ax_array{I,J},'XLim',[axis_arr{4,1}(1,1) axis_arr{4,1}(1,2)],...
                                  'YLim',[axis_arr{I,J}(1,1) axis_arr{I,J}(1,2)],...
                                  'Box','On');
                % Setup the FontSize
                set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                  'FontSize',control.setup.fonts(1,1).FontSize,...
                                  'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                  'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                  'FontUnits',control.setup.fonts(1,1).FontUnits)
                if strcmpi(plot_arr_str,'1x1 (large)')
                    % Setup the FontSize
                    set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                      'FontSize',control.setup.fonts(1,1).FontSize,...
                                      'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                      'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                      'FontUnits',control.setup.fonts(1,1).FontUnits)
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth)
                    % Create x-axis titles
                    if I == 1
                        xlab_str = get(xax_ppan_pop1,'String');
                        xlab_str = strcmpi(xlab_str{get(xax_ppan_pop1,'Value'),1},control.header.valid);
                        xind = find(xlab_str); xind = xind(1,1);
                        if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                            disp(data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn)
                            xlabel(ax_array{I,J},...
                                            sprintf('%s [%s]',control.header.valid{xind,3},...
                                            data(1,1).(control_datatype).(control.header.valid{xind,1}).UnitIn),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        else
                            xlabel(ax_array{I,J},...
                                            sprintf('%s',control.header.valid{xind,3}),...
                                            'FontName',control.setup.fonts(1,1).FontName,...
                                            'FontSize',control.setup.fonts(1,1).FontSize,...
                                            'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                            'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                            'Color',control.setup.fonts(1,1).Color,...
                                            'FontUnits',control.setup.fonts(1,1).FontUnits)
                        end
                    end
                    % Create y-axis titles
                    ylab_str = get(yax_ppan_pop1{I,J},'String'); 
                    ylab_str = strcmpi(ylab_str{get(yax_ppan_pop1{I,J},'Value'),1},control.header.valid);
                    yind = find(ylab_str); yind = yind(1,1);
                    if sum(strcmpi(data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn,{'ratio';'molar ratio'})) == 0
                        ylabel(ax_array{I,J},...
                                        sprintf('%s [%s]',control.header.valid{yind,3},...
                                        data(1,1).(control_datatype).(control.header.valid{yind,1}).UnitIn),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    else
                        ylabel(ax_array{I,J},...
                                        sprintf('%s',control.header.valid{yind,3}),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    end
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth)
                    
                    % Plot the data
                    % Get the strings out of the popups
                    xs = get(xax_ppan_pop1,'String'); xs = xs{get(xax_ppan_pop1,'Value'),1};
                    ys = get(yax_ppan_pop1{I,J},'String'); ys = ys{get(yax_ppan_pop1{I,J},'Value'),1};
                    % Setup scale factor
                    control.scafac = 1.0;
                    % Calculate the normalized values for ternary plot and plot them in
                    % inverted order, that the last dataset is found at the bottom
                    for nr_dataset = files_op:-1:1
                        % Check if the checkbox for the dataset is enabled
                        if true(opt_check(nr_dataset,1))
                            % Get the correct components from data
                            % For x-axis
                            if isfield(data(1,nr_dataset).(control_datatype),xs)
                                xcalc = data(1,nr_dataset).(control_datatype).(xs).Values;
                            else
                                xcalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),xs);
                            end
                            % For y-axis
                            if isfield(data(1,nr_dataset).(control_datatype),ys)
                                ycalc = data(1,nr_dataset).(control_datatype).(ys).Values;
                            else
                                ycalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),ys);
                            end

                            % Get the size of the normalized values
                            [m,~] = size(xcalc);
                            % Enable hold
                            hold(ax_array{I,J},'on')
                                % Plot the data in this loop
                                for nr_dat = 1:1:m
                                    % Check if columns were supplied in the input and not
                                    % overwritten by the label option
                                    if data(1,nr_dataset).symbol.op.op == true && data(1,nr_dataset).symbol.op.override == false
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew(nr_dat,1).*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol(nr_dat,1)),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size(nr_dat,1).*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec{nr_dat,1},...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc{nr_dat,1});
                                    else
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew.*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size.*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec,...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc);
                                    end
                                    % Plot also labels if enabled
                                    if data(1,nr_dataset).label.op.disp == true
                                        % Check if columns were supplied in the input and not
                                        % overwritten by the label option
                                        if data(1,nr_dataset).label.op.op == true && data(1,nr_dataset).label.op.override == false
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(nr_dat,nr_dataset).label.FontName{nr_dat,1},...
                                                                 'FontSize',data(nr_dat,nr_dataset).label.FontSize(nr_dat,1).*control.scafac,...
                                                                 'FontWeight',data(nr_dat,nr_dataset).label.FontWeight{nr_dat,1},...
                                                                 'FontAngle',data(nr_dat,nr_dataset).label.FontAngle{nr_dat,1},...
                                                                 'Color',data(nr_dat,nr_dataset).label.Color{nr_dat,1},...
                                                                 'FontUnits',data(nr_dat,nr_dataset).label.FontUnits{nr_dat,1},...
                                                                 'VerticalAlignment',data(nr_dat,nr_dataset).label.VertAlign{nr_dat,1},...
                                                                 'HorizontalAlignment',data(nr_dat,nr_dataset).label.HoriAlign{nr_dat,1});
                                        else
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(1,nr_dataset).label.FontName,...
                                                                 'FontSize',data(1,nr_dataset).label.FontSize.*control.scafac,...
                                                                 'FontWeight',data(1,nr_dataset).label.FontWeight,...
                                                                 'FontAngle',data(1,nr_dataset).label.FontAngle,...
                                                                 'Color',data(1,nr_dataset).label.Color,...
                                                                 'FontUnits',data(1,nr_dataset).label.FontUnits,...
                                                                 'VerticalAlignment',data(1,nr_dataset).label.VertAlign,...
                                                                 'HorizontalAlignment',data(1,nr_dataset).label.HoriAlign);
                                        end
                                    end
                                end
                            % Disable hold
                            hold(ax_array{I,J},'off')
                        end
                    end
                else
                    % Setup the FontSize
                    set(ax_array{I,J},'FontName',control.setup.fonts(1,1).FontName,...
                                      'FontSize',control.setup.fonts(1,1).FontSize.*0.6,...
                                      'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                      'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                      'FontUnits',control.setup.fonts(1,1).FontUnits)
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth.*0.6)
                    % Create x-axis titles
                    if I == M
                      xlab_str = get(xax_ppan_pop1,'String'); 
                        xlab_str = strcmpi(xlab_str{get(xax_ppan_pop1,'Value'),1},control.header.valid);
                        xind = find(xlab_str); xind = xind(1,1);
                        xlabel(ax_array{I,J},...
                                        sprintf('%s [%s]',control.header.valid{xind,3},control.header.valid{xind,4}),...
                                        'FontName',control.setup.fonts(1,1).FontName,...
                                        'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                        'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                        'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                        'Color',control.setup.fonts(1,1).Color,...
                                        'FontUnits',control.setup.fonts(1,1).FontUnits)
                    else
                        set(ax_array{I,J},'XTickLabel',{''})
                    end
                    % Create y-axis titles
                    % Create y-axis titles
                    ylab_str = get(yax_ppan_pop1{I,J},'String'); 
                    ylab_str = strcmpi(ylab_str{get(yax_ppan_pop1{I,J},'Value'),1},control.header.valid);
                    yind = find(ylab_str); yind = yind(1,1);
                    ylabel(ax_array{I,J},...
                                    sprintf('%s [%s]',control.header.valid{yind,3},control.header.valid{yind,4}),...
                                    'FontName',control.setup.fonts(1,1).FontName,...
                                    'FontSize',control.setup.fonts(1,1).FontSize.*0.75,...
                                    'FontWeight',control.setup.fonts(1,1).FontWeight,...
                                    'FontAngle',control.setup.fonts(1,1).FontAngle,...
                                    'Color',control.setup.fonts(1,1).Color,...
                                    'FontUnits',control.setup.fonts(1,1).FontUnits)
                    % Setup the Lineswidth
                    set(ax_array{I,J},'LineWidth',control.setup.lines(1,1).LineWidth.*0.6)
                    
                    
                    % Plot the data
                    % Get the strings out of the popups
                    xs = get(xax_ppan_pop1,'String'); xs = xs{get(xax_ppan_pop1,'Value'),1};
                    ys = get(yax_ppan_pop1{I,J},'String'); ys = ys{get(yax_ppan_pop1{I,J},'Value'),1};
                    % Setup scale factor
                    control.scafac = 0.6;
                    % Calculate the normalized values for ternary plot and plot them in
                    % inverted order, that the last dataset is found at the bottom
                    for nr_dataset = files_op:-1:1
                        % Check if the checkbox for the dataset is enabled
                        if true(opt_check(nr_dataset,1))
                            % Get the correct components from data
                            % For x-axis
                            if isfield(data(1,nr_dataset).(control_datatype),xs)
                                xcalc = data(1,nr_dataset).(control_datatype).(xs).Values;
                            else
                                xcalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),xs);
                            end
                            % For y-axis
                            if isfield(data(1,nr_dataset).(control_datatype),ys)
                                ycalc = data(1,nr_dataset).(control_datatype).(ys).Values;
                            else
                                ycalc = calc_axis(data(1,nr_dataset),control.header.valid(:,1),ys);
                            end

                            % Get the size of the normalized values
                            [m,~] = size(xcalc);
                            % Enable hold
                            hold(ax_array{I,J},'on')
                                % Plot the data in this loop
                                for nr_dat = 1:1:m
                                    % Check if columns were supplied in the input and not
                                    % overwritten by the label option
                                    if data(1,nr_dataset).symbol.op.op == true && data(1,nr_dataset).symbol.op.override == false
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew(nr_dat,1).*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol(nr_dat,1)),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size(nr_dat,1).*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec{nr_dat,1},...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc{nr_dat,1});
                                    else
                                        plot(xcalc(nr_dat),ycalc(nr_dat),'Parent',ax_array{I,J},...
                                                           'LineStyle','none','LineWidth',data(1,nr_dataset).symbol.edgew.*control.scafac,...
                                                           'Marker',markerid(data(1,nr_dataset).symbol.symbol),...
                                                           'MarkerSize',data(1,nr_dataset).symbol.size.*control.scafac,...
                                                           'MarkerEdgeColor',data(1,nr_dataset).symbol.mec,...
                                                           'MarkerFaceColor',data(1,nr_dataset).symbol.mfc);
                                    end
                                    % Plot also labels if enabled
                                    if data(1,nr_dataset).label.op.disp == true
                                        % Check if columns were supplied in the input and not
                                        % overwritten by the label option
                                        if data(1,nr_dataset).label.op.op == true && data(1,nr_dataset).label.op.override == false
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(nr_dat,nr_dataset).label.FontName{nr_dat,1},...
                                                                 'FontSize',data(nr_dat,nr_dataset).label.FontSize(nr_dat,1).*control.scafac,...
                                                                 'FontWeight',data(nr_dat,nr_dataset).label.FontWeight{nr_dat,1},...
                                                                 'FontAngle',data(nr_dat,nr_dataset).label.FontAngle{nr_dat,1},...
                                                                 'Color',data(nr_dat,nr_dataset).label.Color{nr_dat,1},...
                                                                 'FontUnits',data(nr_dat,nr_dataset).label.FontUnits{nr_dat,1},...
                                                                 'VerticalAlignment',data(nr_dat,nr_dataset).label.VertAlign{nr_dat,1},...
                                                                 'HorizontalAlignment',data(nr_dat,nr_dataset).label.HoriAlign{nr_dat,1});
                                        else
                                            text(xcalc(I),ycalc(I),data(1,nr_dataset).(control_datatype).Samples{nr_dat,1},'Parent',ax_array{I,J},...
                                                                 'FontName',data(1,nr_dataset).label.FontName,...
                                                                 'FontSize',data(1,nr_dataset).label.FontSize.*control.scafac,...
                                                                 'FontWeight',data(1,nr_dataset).label.FontWeight,...
                                                                 'FontAngle',data(1,nr_dataset).label.FontAngle,...
                                                                 'Color',data(1,nr_dataset).label.Color,...
                                                                 'FontUnits',data(1,nr_dataset).label.FontUnits,...
                                                                 'VerticalAlignment',data(1,nr_dataset).label.VertAlign,...
                                                                 'HorizontalAlignment',data(1,nr_dataset).label.HoriAlign);
                                        end
                                    end
                                end
                            % Disable hold
                            hold(ax_array{I,J},'off')
                        end
                    end
                end
                
                % Checkout and change the Y-axis type (lin vs. log)
                % Change labels when logarithmic
                ylab_type = get(yax_ppan_pop2{I,J},'String'); ylab_type = ylab_type{get(yax_ppan_pop2{I,J},'Value'),1};
                if strcmpi(ylab_type,'Logarithmic')
                    set(ax_array{I,J},'YScale','log')
                    ax_str = get(ax_array{I,J},'YTick'); set(ax_array{I,J},'YTickLabel',ax_str);
                elseif strcmpi(ylab_type,'Linear')
                    set(ax_array{I,J},'YScale','linear')
                end
                
                % Checkout and change the X-axis type (lin vs. log)
                % Change labels when logarithmic
                xlab_type = get(xax_ppan_pop2,'String'); xlab_type = xlab_type{get(xax_ppan_pop2,'Value'),1};
                if strcmpi(xlab_type,'Logarithmic')
                    set(ax_array{I,J},'XScale','log')
                    ax_str = get(ax_array{I,J},'XTick'); set(ax_array{I,J},'XTickLabel',ax_str);
                elseif strcmpi(xlab_type,'Linear')
                    set(ax_array{I,J},'XScale','linear')
                end
                
                % Make axes visible
                set(ax_array{I,J},'Visible','On')
                
                % Update X-position
                % = 310 pix
                xpos = xpos + 0.275;
            end
            % Update Y-position #
            % = 275 pix
            ypos = ypos - 0.290;
        end
        
        % Make figure visible or export in png / eps
        if strcmpi(get(obj,'Tag'),'fig')
            % Make the new figure visible
            set(plotfig,'Visible','on');
        else
            % Print the figure out
            if strcmpi(get(obj,'Tag'),'png')
                % Change the background color of the GUI to black
                set(plotfig,'Color',[1.0,1.0,1.0],'PaperPositionMode','auto');
                % Open save window to select output file
                [file,path] = uiputfile('*.png','Save plot as portable network graphics!',...
                                                strcat(save_path,'/export/',control.prj_name,'_plotomat','.png'));
                % Only print if file was selected
                if ischar(file)
                    print(plotfig,fullfile(path,file),'-dpng','-zbuffer','-r500')
                end
            elseif strcmpi(get(obj,'Tag'),'eps')
                % Change the background color of the GUI to black
                set(plotfig,'Color',[1.0,1.0,1.0],...
                            'PaperPositionMode','manual','PaperPosition',[-1.0,1,38.8,28.1],...
                            'PaperOrientation','landscape',...
                            'PaperSize',[42 30],'PaperUnits','centimeters');
                % Open save window to select output file
                [file,path] = uiputfile('*.eps','Save plot as encapsuled post script!',...
                                                strcat(save_path,'/export/',control.prj_name,'_plotomat','.eps'));
                % Only print if file was selected
                if ischar(file)
                    print(plotfig,fullfile(path,file),'-depsc2','-painters')
                end
            end
        end
    end

%% 00x Make GUI visible
set(pm_main,'Visible','on');

end

